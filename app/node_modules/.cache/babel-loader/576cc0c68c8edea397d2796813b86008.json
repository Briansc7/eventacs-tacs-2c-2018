{"ast":null,"code":"/*\n\n\n*/\nvar moment = require('moment');\n\nvar Parser = require('../parser').Parser;\n\nvar ParsedResult = require('../../result').ParsedResult;\n/*\n  Valid patterns:\n  - esta mañana -> today in the morning\n  - esta tarde -> today in the afternoon/evening\n  - esta noche -> tonight\n  - ayer por la mañana -> yesterday in the morning\n  - ayer por la tarde -> yesterday in the afternoon/evening\n  - ayer por la noche -> yesterday at night\n  - mañana por la mañana -> tomorrow in the morning\n  - mañana por la tarde -> tomorrow in the afternoon/evening\n  - mañana por la noche -> tomorrow at night\n  - anoche -> tomorrow at night\n  - hoy -> today\n  - ayer -> yesterday\n  - mañana -> tomorrow\n */\n\n\nvar PATTERN = /(\\W|^)(ahora|esta\\s*(mañana|tarde|noche)|(ayer|mañana)\\s*por\\s*la\\s*(mañana|tarde|noche)|hoy|mañana|ayer|anoche)(?=\\W|$)/i;\n\nexports.Parser = function ESCasualDateParser() {\n  Parser.apply(this, arguments);\n\n  this.pattern = function () {\n    return PATTERN;\n  };\n\n  this.extract = function (text, ref, match, opt) {\n    var text = match[0].substr(match[1].length);\n    var index = match.index + match[1].length;\n    var result = new ParsedResult({\n      index: index,\n      text: text,\n      ref: ref\n    });\n    var refMoment = moment(ref);\n    var startMoment = refMoment.clone();\n    var lowerText = text.toLowerCase().replace(/\\s+/g, ' ');\n\n    if (lowerText == 'mañana') {\n      // Check not \"Tomorrow\" on late night\n      if (refMoment.hour() > 1) {\n        startMoment.add(1, 'day');\n      }\n    } else if (lowerText == 'ayer') {\n      startMoment.add(-1, 'day');\n    } else if (lowerText == 'anoche') {\n      result.start.imply('hour', 0);\n\n      if (refMoment.hour() > 6) {\n        startMoment.add(-1, 'day');\n      }\n    } else if (lowerText.match(\"esta\")) {\n      var secondMatch = match[3].toLowerCase();\n\n      if (secondMatch == \"tarde\") {\n        result.start.imply('hour', 18);\n      } else if (secondMatch == \"mañana\") {\n        result.start.imply('hour', 6);\n      } else if (secondMatch == \"noche\") {\n        // Normally means this coming midnight\n        result.start.imply('hour', 22);\n        result.start.imply('meridiem', 1);\n      }\n    } else if (lowerText.match(/por\\s*la/)) {\n      var firstMatch = match[4].toLowerCase();\n\n      if (firstMatch === 'ayer') {\n        startMoment.add(-1, 'day');\n      } else if (firstMatch === 'mañana') {\n        startMoment.add(1, 'day');\n      }\n\n      var secondMatch = match[5].toLowerCase();\n\n      if (secondMatch == \"tarde\") {\n        result.start.imply('hour', 18);\n      } else if (secondMatch == \"mañana\") {\n        result.start.imply('hour', 9);\n      } else if (secondMatch == \"noche\") {\n        // Normally means this coming midnight\n        result.start.imply('hour', 22);\n        result.start.imply('meridiem', 1);\n      }\n    } else if (lowerText.match(\"ahora\")) {\n      result.start.imply('hour', refMoment.hour());\n      result.start.imply('minute', refMoment.minute());\n      result.start.imply('second', refMoment.second());\n      result.start.imply('millisecond', refMoment.millisecond());\n    }\n\n    result.start.assign('day', startMoment.date());\n    result.start.assign('month', startMoment.month() + 1);\n    result.start.assign('year', startMoment.year());\n    result.tags['ESCasualDateParser'] = true;\n    return result;\n  };\n};","map":null,"metadata":{},"sourceType":"script"}