{"ast":null,"code":"/*\n    \n    \n*/\nvar moment = require('moment');\n\nvar Parser = require('../parser').Parser;\n\nvar ParsedResult = require('../../result').ParsedResult;\n\nvar util = require('../../utils/JP');\n\nvar PATTERN = /(?:(同|((昭和|平成)?([0-9０-９]{2,4})))年\\s*)?([0-9０-９]{1,2})月\\s*([0-9０-９]{1,2})日/i;\nvar YEAR_GROUP = 2;\nvar ERA_GROUP = 3;\nvar YEAR_NUMBER_GROUP = 4;\nvar MONTH_GROUP = 5;\nvar DAY_GROUP = 6;\n\nexports.Parser = function JPStandardParser() {\n  Parser.apply(this, arguments);\n\n  this.pattern = function () {\n    return PATTERN;\n  };\n\n  this.extract = function (text, ref, match, opt) {\n    var startMoment = moment(ref);\n    var result = new ParsedResult({\n      text: match[0],\n      index: match.index,\n      ref: ref\n    });\n    var month = match[MONTH_GROUP];\n    month = util.toHankaku(month);\n    month = parseInt(month);\n    var day = match[DAY_GROUP];\n    day = util.toHankaku(day);\n    day = parseInt(day);\n    startMoment.set('date', day);\n    startMoment.set('month', month - 1);\n    result.start.assign('day', startMoment.date());\n    result.start.assign('month', startMoment.month() + 1);\n\n    if (!match[YEAR_GROUP]) {\n      //Find the most appropriated year\n      startMoment.year(moment(ref).year());\n      var nextYear = startMoment.clone().add(1, 'y');\n      var lastYear = startMoment.clone().add(-1, 'y');\n\n      if (Math.abs(nextYear.diff(moment(ref))) < Math.abs(startMoment.diff(moment(ref)))) {\n        startMoment = nextYear;\n      } else if (Math.abs(lastYear.diff(moment(ref))) < Math.abs(startMoment.diff(moment(ref)))) {\n        startMoment = lastYear;\n      }\n\n      result.start.assign('day', startMoment.date());\n      result.start.assign('month', startMoment.month() + 1);\n      result.start.imply('year', startMoment.year());\n    } else if (match[YEAR_GROUP].match('同年')) {\n      result.start.assign('year', startMoment.year());\n    } else {\n      var year = match[YEAR_NUMBER_GROUP];\n      year = util.toHankaku(year);\n      year = parseInt(year);\n\n      if (match[ERA_GROUP] == '平成') {\n        year += 1988;\n      } else if (match[ERA_GROUP] == '昭和') {\n        year += 1925;\n      }\n\n      result.start.assign('year', year);\n    }\n\n    result.tags['JPStandardParser'] = true;\n    return result;\n  };\n};","map":null,"metadata":{},"sourceType":"script"}